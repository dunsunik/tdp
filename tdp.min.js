!function(t){var e=function(e,a,n){function i(e,a){var n=e.indexOf("."),i=e.indexOf("#"),o="";if(n>0||i>0){var s;s=n>0&&i>0?Math.min(n,i):n>0?n:i,o=e.substring(s),e=e.substring(0,s)}var l=o.split("."),r=t("<"+e+"></"+e+">"),d="",u="";return t.each(l,function(t,e){e.indexOf("#")>=0?d+=e.replace(/^#/,""):u+=e+" "}),d.length&&r.attr("id",d),u.length&&r.attr("class",u.trim()),t(r).html(a)}var o=this;if(this._defaults={scrollToErrorDuration:2e3,dialogShowDuration:500,dialogCloseDuration:500,dialogAutoclose:!1,validationOkElement:"span.tdp-vld-ok",validationOkShow:function(t){return t.fadeIn("slow")},validationOkHide:function(t){return t.fadeOut("fast")},validationWorkingElement:"span.tdp-vld-working",validationWorkingShow:function(t){return t.fadeIn("slow")},validationWorkingHide:function(t){return t.fadeOut("fast")},validationMessageElement:"span.tdp-vld-msg",validationMessageSeparator:"<br />",validationMessageProcessor:function(t){return t.join(o.options("validationMessageSeparator"))},validationMessageFlashDelay:300,validationMessageFlash:function(t){return t.fadeIn("slow").fadeOut("slow").fadeIn("slow").fadeOut("slow").fadeIn("slow")},validationMessageShow:function(t){return t.fadeIn("slow")},validationMessageHide:function(t){return t.fadeOut("fast")},validatorRequestProcessor:function(t,e){return{data:t,params:e}},validatorResponseProcessor:function(t){return t?t.response:!1},submitMethod:null,verbose:!1,logger:null},this.options=function(e){return e?"string"==typeof e?this._options[e]:t.extend(!0,this._options,e):this._options},!n||"object"!=typeof n){if(!a||"object"!=typeof a)return console.log("$.TdpPlugin constructor called without mandatory parameters");n=a,a={}}a&&"object"==typeof a||(a={}),this._options=t.extend(!0,{},this._defaults,a),this._parameters=n,Object.keys(this._parameters.values).forEach(function(a){var n=o._parameters.values[a];n.validated=null,n.old_value=null,e.find('input[name="'+a+'"],textarea[name="'+a+'"],select[name="'+a+'"]').each(function(){input_element=t(this),"select"===n.type&&n.values&&(e.find("option").remove(),n.values.some(function(t){var e=[];e="string"==typeof t?[t,t,!1]:[t[0],t.length>1?t[1]:t[0],t.length>2?!t[2]:!1];var a=i("option",t[1]).attr("value",t[0]);t[2]&&a.attr("disabled"),input_element.append(a)})),t(o.options("validationMessageElement")+'[name="'+a+'"]').length||t(o.options("validationOkElement")+'[name="'+a+'"]').length||input_element.after(i(o.options("validationMessageElement"),"").attr("name",a).hide()).after(i(o.options("validationOkElement"),"âœ“").attr("name",a).hide()),input_element.val(n.value),o.options("validationMessageHide")(t(o.options("validationMessageElement")+'[name="'+a+'"]').first()),o.options("validationOkHide")(t(o.options("validationOkElement")+'[name="'+a+'"]').first()),input_element.on("input",function(){o.validate(this,["validator","min","not"])}),input_element.on("change, blur",function(){o.validate(this)})})}),this.options("logger")&&t(this.options("logger")).length?this._log=t(this.options("logger")):this._log=null,e.submit(function(a){var n=null,i=0;return Object.keys(o._parameters.values).forEach(function(a){var s=o._parameters.values[a];if(!s.validated){var l=e.find('input[name="'+a+'"],textarea[name="'+a+'"],select[name="'+a+'"]').first();null===s.validated&&o.validate(l),n||(n=l),setTimeout(function(){o.options("validationMessageFlash")(t(o.options("validationMessageElement")+'[name="'+a+'"]').first())},o.options("validationMessageFlashDelay")*i++)}}),n?(t("html, body").animate({scrollTop:n.offset().top},o.options("scrollToErrorDuration")),!1):null!==o.options("submitMethod")?(a.preventDefault(),o.options("submitMethod")()):!0}),this.show=function(){return e.show(this.options("dialogShowDuration")),e},this.hide=function(){return e.hide(this.options("dialogCloseDuration")),e},this.validate=function(e,a){var n=e instanceof jQuery?e:t(e),i=this;if(n.is("input,textarea,select")){var o=this,s=n.attr("name");if(s in this._parameters.values){var l=n.val(),r=t(i.options("validationMessageElement")+'[name="'+s+'"]').first(),d=t(i.options("validationOkElement")+'[name="'+s+'"]').first(),u=this._parameters.values[s];if(l===u.old_value)return;a||(u.old_value=l);var p=[],v=!1;if(!u.conditions||!u.conditions.length)return u.validated=!0,!0;u.conditions.some(function(e){if(a&&t.inArray(e.type,a)>-1)return!1;var n,c,f=!0;switch(u.type){case"tel":case"email":case"text":n=l.length,c=e.value;break;case"date":n=new Date(l),c=new Date(e.value);break;case"integer":n=parseInt(l,10),c=e.value;break;case"float":n=parseFloat(l,10),c=e.value;break;case"checkbox":case"radio":case"select":n=l,c=e.value;break;case"hidden":break;default:console.warn('Input "'+s+'" has unknown input type "'+u.type+'"')}switch(null!==o._log&&o._log.append("Evaluating condition '"+e.type+"("+n+", "+c+")'\n"),e.type){case"regular":var h=new RegExp(e.value);f=h.test(l);break;case"not":f=n!==c;break;case"notNaN":f=!Number.isNaN(n);break;case"valid":f=n==l;break;case"min":f=!Number.isNaN(n)&&n>=c;break;case"max":f=!Number.isNaN(n)&&c>=n;break;case"validator":i.options("validationWorkingShow")(t(i.options("validationWorkingElement")+'[name="'+s+'"]').first()),v=!0;t.ajax({url:e.value,type:"POST",data:i.options("validatorRequestProcessor")(l,e.params),dataType:"json",timeout:5e3,cache:!1,success:function(t){var a=i.options("validatorResponseProcessor")(t),n=!1;"string"==typeof a?(u.validated=0,n=i.options("validationMessageProcessor")([a])):(u.validated=!a,n=a?e.message:!1),n?(r.html(n),i.options("validationMessageShow")(r),i.options("validationOkHide")(d)):(i.options("validationMessageHide")(r),i.options("validationOkShow")(d))},error:function(t){u.validated=0,f=i.options("validationMessageProcessor")([e.message]),r.html(f),i.options("validationMessageShow")(r),i.options("validationOkHide")(d)},async:!0}).always(function(){i.options("validationWorkingHide")(t(i.options("validationWorkingElement")+'[name="'+s+'"]').first())});break;default:console.warn('Unknown condition type "'+e.type+'"')}return!f&&(p.push(e.message),e.last)?!0:!1}),u.validated=0===p.length;var c=this.options("validationMessageProcessor")(p);return c?(r.html(c),this.options("validationMessageShow")(r),this.options("validationOkHide")(d)):(this.options("validationMessageHide")(r),a||v||this.options("validationOkShow")(d)),u.validated}console.warn('Input "'+s+'" is not defined for validation')}else console.warn('Element "'+e+'" is not valid input')}};t.fn.tdp=function(a){function n(){var e=t(this),a=e.data("TdpPlugin");d.push(a)}function i(t){var e=d[t];if(!e)return console.warn("$.TdpPlugin not instantiated yet"),console.info(this),void u.push(void 0);if("function"==typeof e[l]){var a=e[l].apply(e,r);u.push(a)}else console.warn("Method '"+l+"' not defined in $.TdpPlugin")}function o(){var a=t(this),n=new e(a,s,r);a.data("TdpPlugin",n)}var s,l="string"==typeof a?a:void 0,r=arguments.length>1?Array.prototype.slice.call(arguments,1)[0]:void 0,d=[],u=[];return l?(this.each(n),this.each(i),u.length>1?u:u[0]):(s="object"==typeof a?a:void 0,this.each(o))}}(jQuery);
